-- select * from prices;
SELECT * FROM 
(
	SELECT AVG(askprice), time_bucket('1 minutes', timestamp) AS one_min
	FROM prices
	WHERE timestamp < date_trunc('minute', NOW())
	AND timestamp >= interval '1m' +
	(SELECT MAX(timestamp) FROM trendperminute)
	GROUP BY one_min
) AS avgperminute
JOIN trendperminute
ON trendperminute.timestamp = avgperminute.one_min - interval '1m';